# ===============================
# Nginx 메인 설정
# ===============================

# CPU 수에 맞춰 worker 프로세스 자동 설정
worker_processes auto;

# 한 워커당 최대 커넥션 수 (커넥션 = 동시 접속자 + keep-alive 커넥션 등)
events {
    worker_connections 1024;
}

http {
    # MIME 타입 설정 포함 (확장자 → Content-Type 매핑)
    include       mime.types;

    # 확장자를 알 수 없는 경우 기본 타입 지정 (binary stream → 다운로드 처리)
    default_type  application/octet-stream;

    # 정적 파일 전송 시 sendfile() 시스템 콜 사용 (성능 향상)
    sendfile        on;

    # keep-alive 연결 유지 시간 (초) — 클라이언트 커넥션을 재활용
    keepalive_timeout  65;

    # ===============================
    # 정적 웹사이트용 서버 설정
    # ===============================
    server {
        listen 80;
        server_name _;

        # 정적 파일 root 경로
        root /usr/share/nginx/html;
        index index.html;

        # GCP Load Balancer의 Health Check endpoint
        location /healthz {
            return 200 'ok';
            add_header Content-Type text/plain;
        }

        # Vue Router (history mode) 지원
        # → 실제 파일이 없으면 index.html로 라우팅
        location / {
            try_files $uri $uri/ /index.html;
        }
    }
}
